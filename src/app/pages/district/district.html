<div>
  <!-- weather alerts Marquee-->
  <div class="news-ticker-wrapper" *ngIf="alertMessages.length > 0">
    <div class="ticker-label">Recent Update's</div>
    <div class="news-ticker">
      <div class="ticker-content">
        <span *ngFor="let msg of alertMessages">
          {{ msg }} <span class="spacer"></span>
        </span>

        <span *ngFor="let msg of alertMessages">
          {{ msg }} <span class="spacer"></span>
        </span>
      </div>
    </div>
  </div>

  <!-- Map Show -->
  <div
    class="container-fluid full-height-container"
    style="margin-bottom: 20px"
  >
    <div class="data-map-div row g-4 align-items-stretch h-100">
      <!-- Left Panel -->
      <div class="weather-panel col-lg-5 col-md-5 col-sm-12 d-flex flex-column">
        <div class="equal-height-panel">
          <h5 class="text-success mb-2" style="margin-left: 15px">
            {{ current_forecast.location }}
          </h5>

          <div
            class="mx-2 card flex-grow-1 p-3"
            style="background-color: white; border: 1px solid #b2f0b2"
          >
            <p class="text-muted fw-bold mb-1">{{selectedDay}}'S WEATHER</p>
            <p class="text-secondary solid mb-3">
              {{ current_forecast.current_time }}
              <!-- <p class="text-secondary solid mb-3">{{ current_forecast.current_time | date: 'EEE, dd MMM y, hh:mm a' }} -->
            </p>

            <div class="d-flex align-items-center mb-3">
              <img
                [src]="'https:' + current_forecast.icon"
                alt="weather-icon"
                width="48"
                class="me-3"
              />
              <div style="display: flex; flex-direction: row; gap: 10px">
                <div
                  style="
                    border-right: 2px solid rgb(141, 140, 140);
                    padding: 0px 9px 0px 0px;
                  "
                >
                  <h3
                    class="display-5 fw-semibold mb-0"
                    style="font-size: 32px"
                  >
                    {{currentHourRainPercent}}%
                  </h3>
                </div>
                <div style="display: flex; flex-direction: column">
                  <span style="font-size: 12px">Rain Probability</span>
                  <span style="font-weight: 600">{{currentHourRainMM}} mm</span>
                </div>
              </div>
              <!-- <span>{{ current_forecast.temp }}¬∞C    </span> -->
            </div>

            <p class="lead mb-4">{{ current_forecast.condition }}</p>

            <div
              class="weather-info-card d-flex flex-column flex-wrap text-muted small"
            >
              <!-- Weather Stats -->
              <div
                class="weather-details-card d-flex flex-wrap justify-content-around"
              >
                <div class="weather-detail">
                  <div class="weather-icon">
                    <i class="fa-solid fa-temperature-half"></i>
                  </div>
                  <span> Temp:</span>
                  <strong>{{ current_forecast.temp }}¬∞C</strong>
                </div>
                <div class="weather-detail">
                  <div class="weather-icon">
                    <i class="fa-solid fa-temperature-half"></i>
                  </div>
                  <span>Feels Like:</span>
                  <strong>{{ current_forecast.feels_like }}¬∞C</strong>
                </div>
                <div class="weather-detail">
                  <div class="weather-icon">
                    <i class="fa-solid fa-wind"></i>
                  </div>
                  <span>Wind:</span>
                  <strong>{{ current_forecast.wind_speed }} km/h</strong>
                </div>
                <div class="weather-detail">
                  <div class="weather-icon">
                    <i class="fa-solid fa-compass"></i>
                  </div>
                  <span>Wind Dir: </span>
                  <strong>{{ current_forecast.wind_dir }}</strong>
                </div>

                <div class="weather-detail">
                  <div class="weather-icon">
                    <i class="fa-solid fa-gauge-high"></i>
                  </div>
                  <span>Pressure: </span>
                  <strong>{{ current_forecast.pressure }} mbar</strong>
                </div>
                <div class="weather-detail">
                  <div class="weather-icon">
                    <i class="fa-solid fa-eye"></i>
                  </div>
                  <span>Visibility:</span>
                  <strong>{{ current_forecast.visibility }} km</strong>
                </div>
                <div class="weather-detail">
                  <div class="weather-icon">
                    <i class="-px-3 fa-solid fa-sun"></i>
                  </div>
                  <span>UV Index:</span>
                  <strong>{{ current_forecast.uv_index }}</strong>
                </div>
                <div class="weather-detail">
                  <div class="weather-icon">
                    <i class="fa-solid fa-droplet"></i>
                  </div>
                  <span>Humidity: </span>
                  <strong>{{ current_forecast.humidity }}%</strong>
                </div>
              </div>
            </div>

            <p class="small mt-4 text-start">
              <strong>Refresh:</strong> {{ lastUpdatedTime | date: 'EEE, dd MMM
              y, hh:mm a' }}
              <i
                class="fa-solid fa-rotate-right ms-2"
                role="button"
                style="cursor: pointer"
                (click)="loadWeather()"
                [class.fa-spin]="loading"
              ></i>
            </p>
          </div>
        </div>
      </div>

      <!-- Right Panel -->
      <div class="map-panel col-lg-7 col-md-7 col-sm-12 d-flex flex-column">
        <div class="equal-height-panel" id="map-component-container">
          <div class="row justify-content-center">
            <div class="col-md-6">
              <div class="mb-3">
                <select
                  class="stylish-select form-select border border-success"
                  [(ngModel)]="SelectedDistrict"
                  (ngModelChange)="onDistrictChange($event)"
                >
                  <!-- Placeholder -->
                  <option [ngValue]="null">Select District...</option>

                  <!-- Actual options -->
                  <option
                    *ngFor="let dist of districtList"
                    [ngValue]="dist.name"
                  >
                    {{ dist.name }}
                  </option>
                </select>
              </div>
            </div>
            <div class="col-md-6 submit-field">
              <div class="mb-3">
                <button type="button" (click)="openDistrictModal()">
                  Send Extreme Affected District Report
                </button>
              </div>
            </div>

            <!-- District Report Modal ************************************************* -->
            <div
              class="modal fade"
              id="districtReportModal"
              tabindex="-1"
              aria-labelledby="districtReportModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                  <!-- Header -->
                  <div class="modal-header">
                    <h5 class="modal-title" id="districtReportModalLabel">
                      Extreme Affected District Report
                    </h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>

                  <!-- Body -->
                  <div class="modal-body">
                    <form #districtForm="ngForm">
                      <div class="row g-3">
                        <!-- Email(s) -->
                        <div class="col-md-6">
                          <label class="form-label">Enter Email(s)</label>
                          <input
                            type="text"
                            class="form-control"
                            placeholder="indus@gmail.com, Email@2, ..."
                            [(ngModel)]="districtEmails"
                            name="districtEmails"
                          />
                        </div>

                        <!-- District List -->
                        <div class="col-md-6">
                          <label class="form-label">District List</label>

                          <div
                            class="dropdown w-100"
                            data-bs-auto-close="outside"
                          >
                            <button
                              class="form-select text-start"
                              type="button"
                              data-bs-toggle="dropdown"
                              aria-expanded="false"
                              style="
                                white-space: nowrap;
                                overflow: hidden;
                                text-overflow: ellipsis;
                              "
                            >
                              {{ getSelectedDistrictNames() || '-- Select
                              Districts --' }}
                            </button>

                            <ul
                              class="dropdown-menu w-100 p-2"
                              style="max-height: 200px; overflow-y: auto"
                              (click)="$event.stopPropagation()"
                            >
                              <!-- Select All -->
                              <li class="form-check">
                                <label
                                  class="form-check-label"
                                  style="cursor: pointer"
                                >
                                  <input
                                    class="form-check-input green-checkbox"
                                    type="checkbox"
                                    [(ngModel)]="selectAllDistrict"
                                    name="selectAllDistrict"
                                    (change)="toggleSelectAllDistrict()"
                                    (click)="$event.stopPropagation()"
                                  />
                                  All Districts
                                </label>
                              </li>

                              <li><hr class="dropdown-divider" /></li>

                              <!-- Each District -->
                              <li
                                *ngFor="let dist of districtList"
                                class="form-check ms-2"
                              >
                                <label
                                  class="form-check-label"
                                  style="cursor: pointer"
                                >
                                  <input
                                    class="form-check-input green-checkbox"
                                    type="checkbox"
                                    [(ngModel)]="dist.checked"
                                    name="district_{{ dist  }}"
                                    (change)="updateSelectAllDistrict()"
                                    (click)="$event.stopPropagation()"
                                  />
                                  {{ dist.name }}
                                </label>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>

                  <!-- Footer -->
                  <div
                    class="modal-footer d-flex justify-content-between align-items-center"
                  >
                    <div>
                      <span
                        *ngIf="sendingDistrict"
                        class="text-success d-flex align-items-center fw-bold"
                      >
                        Sending report<span class="loading-dots"></span>
                      </span>
                    </div>

                    <div>
                      <button
                        type="button"
                        class="btn btn-secondary me-2"
                        data-bs-dismiss="modal"
                        (click)="cancelDistrictReport()"
                      >
                        Cancel
                      </button>

                      <button
                        type="button"
                        class="btn btn-success"
                        (click)="Send_Extreme_Affected_District_Report()"
                        [disabled]="sendingDistrict === true"
                      >
                        Send
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Filter Buttons -->

          <div
            class="weather-filters-button d-flex justify-content-between flex-wrap gap-2 mb-3 responsive-button-group"
          >
            <button
              (click)="selectLayer('rainfall');callToggleRainIDW()"
              [class.active]="selectedLayer  === 'rainfall'"
              class="btn btn-success btn-sm px-2 py-1 text-nowrap d-flex align-items-center justify-content-center gap-2 flex-grow-1"
            >
              <i class="fas fa-cloud-showers-heavy"></i> Rainfall
            </button>
            <button
              (click)="selectLayer('wind'); callToggleWindIDW()"
              [class.active]="selectedLayer  === 'wind'"
              class="btn btn-success btn-sm px-2 py-1 text-nowrap d-flex align-items-center justify-content-center gap-2 flex-grow-1"
            >
              <i class="fas fa-wind"></i> Wind
            </button>
            <button
              (click)="selectLayer('humidity'); callToggleHumidityIDW()"
              [class.active]="selectedLayer  === 'humidity'"
              class="btn btn-success btn-sm px-2 py-1 text-nowrap d-flex align-items-center justify-content-center gap-2 flex-grow-1"
            >
              <i class="fas fa-tint"></i> Humidity
            </button>
            <button
              (click)="selectLayer('fog'); callToggleFogIDW()"
              [class.active]="selectedLayer  === 'fog'"
              class="btn btn-success btn-sm px-2 py-1 text-nowrap d-flex align-items-center justify-content-center gap-2 flex-grow-1"
            >
              <i class="fa-solid fa-eye"></i> Visibility
            </button>
            <button
              (click)="selectLayer('temperature');callToggleTempIDW()"
              [class.active]="selectedLayer  === 'temperature'"
              class="btn btn-success btn-sm px-2 py-1 text-nowrap d-flex align-items-center justify-content-center gap-2 flex-grow-1"
            >
              <i class="fas fa-temperature-high"></i> Temperature
            </button>
          </div>

          <!-- Map Component -->
          <div class="flex-grow-1" id="map-container">
            <app-map-weather></app-map-weather>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Weather Hazard Accordion -->
  <div class="accordion" id="dashboardAccordion">
    <!-- Hourly Weather Accordion Item -->
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingHourly">
        <button
          class="accordion-button"
          [class.collapsed]="activeAccordion !== 'hourly'"
          (click)="toggleAccordion('hourly')"
          [attr.aria-expanded]="activeAccordion === 'hourly'"
        >
          Hourly Weather
        </button>
      </h2>

      <!-- Accordion Collapsible Body -->
      <div
        id="collapseHourly"
        class="accordion-collapse collapse"
        [class.show]="activeAccordion === 'hourly'"
        aria-labelledby="headingHourly"
      >
        <div
          class="accordion-body position-relative"
          style="background-color: white"
        >
          <!-- Hourly Timeline -->
          <div class="position-relative" style="background-color: white">
            <!-- Scroll Arrows -->
            <button
              *ngIf="activeAccordion === 'hourly' && !atScrollStart && hourlyForecastList?.length"
              class="btn btn-light shadow-sm position-absolute top-50 start-0 translate-middle-y rounded-circle"
              style="z-index: 10; border: 1px solid #1471ce"
              (click)="scrollLeft()"
            >
              <i class="fas fa-chevron-left text-secondary"></i>
            </button>

            <!-- Right Scroll Button -->
            <button
              *ngIf="activeAccordion === 'hourly' && !atScrollEnd && hourlyForecastList?.length"
              class="btn btn-light shadow-sm position-absolute top-50 end-0 translate-middle-y rounded-circle"
              style="z-index: 10; border: 1px solid #f6f7f8"
              (click)="scrollRight()"
            >
              <i class="fas fa-chevron-right text-secondary"></i>
            </button>

            <!-- Scrollable Timeline -->
            <div
              *ngIf="activeAccordion === 'hourly' && (hourlyForecastList?.length || 0) > 0"
            >
              <div
                #scrollContainer
                class="d-flex overflow-auto gap-2 px-2 pt-1 pb-2"
                style="scroll-behavior: smooth"
              >
                <div
                  *ngFor="let hour of hourlyForecastList; let i = index"
                  class="hourly-card flex-shrink-0 bg-white p-3 text-center border shadow rounded-lg"
                  [attr.id]="'hour-card-' + i"
                  [class.current-hour]="hour.time === currentHour24"
                  style="min-width: 110px; border-color: green"
                >
                  <div class="text-success fw-semibold small mb-0">
                    {{ hour.time }}
                  </div>
                  <img
                    [src]="'https:' + hour.icon"
                    alt="icon"
                    width="60"
                    height="60"
                    class="mb-0"
                  />
                  <div class="fw-bold text-success mb-1">{{ hour.temp }}¬∞C</div>
                  <div class="text-muted small">
                    <div class="text-muted small">
                      üåßÔ∏è {{ hour.chance_of_rain }}% chance of rain
                    </div>
                    <i class="fas fa-cloud-showers-heavy me-1 text-primary"></i>
                    {{ hour.rain_mm }} mm<br />
                    <i class="fas fa-wind me-1 text-info"></i> {{ hour.wind_kph
                    }} km/h
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--7days forecast-->
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingForecast">
        <button
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#collapseForecast"
          aria-expanded="false"
          aria-controls="collapseForecast"
          (click)="toggleForecast('sevenDayForecast')"
        >
          7-Day Weather Forecast
        </button>
      </h2>
      <div id="collapseForecast" class="accordion-collapse collapse">
        <div class="accordion-body p-3" style="position: relative">
          <!-- Scroll Arrows -->
          <button
            *ngIf="!atScrollStart7DayForecast && dayForecastList?.length"
            class="btn btn-light shadow-sm position-absolute top-50 start-0 translate-middle-y rounded-circle"
            style="z-index: 10; border: 1px solid #1471ce"
            (click)="scrollLeft7DayForeCast()"
          >
            <i class="fas fa-chevron-left text-secondary"></i>
          </button>

          <!-- Right Scroll Button -->
          <button
            *ngIf="!atScrollEnd7DayForecast && dayForecastList?.length"
            class="btn btn-light shadow-sm position-absolute top-50 end-0 translate-middle-y rounded-circle"
            style="z-index: 10; border: 1px solid #f6f7f8"
            (click)="scrollRight7DayForeCast()"
          >
            <i class="fas fa-chevron-right text-secondary"></i>
          </button>

          <!-- Scrollable Weather Cards -->
          <div
            #scrollContainer7DayForecast
            class="d-flex overflow-auto gap-3 py-2 px-1"
            *ngIf="dayForecastList && dayForecastList.length > 0"
          >
            <div
              class="seven-day-container card text-center flex-shrink-0 shadow-sm"
              [ngStyle]="{ 
      'background-color': i === 0 ? '#eaf7ec' : 'white',
      'border-color': 'green'
  }"
              *ngFor="let day of dayForecastList; let i = index"
            >
              <div class="seven-day-weather-data card-body p-3">
                <div class="fw-semibold mb-1">{{ day.date }}</div>
                <div class="d-flex justify-content-between mb-2">
                  <span class="text-primary">min: {{ day.temp_min }}¬∞C</span>
                  <span class="text-primary">max: {{ day.temp_max }}¬∞C</span>
                </div>
                <img
                  [src]="'https:' + day.icon"
                  [alt]="day.description"
                  width="36"
                  height="36"
                  class="mb-2"
                />

                <div class="text-muted small">{{ day.condition_text }}</div>

                <div class="text-muted small">
                  üåßÔ∏è {{ day.chance_of_rain }}% chance of rain
                </div>
                <div class="text-muted small">
                  <i class="fas fa-droplet" style="color: #3498db"></i>
                  Humidity: {{ day.humidity }}%
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Hazards / Bad Weather -->
  </div>
</div>

<!-- Loading Overlay -->
<div *ngIf="isLoading" class="loading-overlay">
  <div class="spinner"></div>
  <p class="loading-text">
    Loading
    <span class="dot dot1">.</span>
    <span class="dot dot2">.</span>
    <span class="dot dot3">.</span>
  </p>
</div>
